<?xml version="1.0" encoding="UTF-8"?>
<shader type="fragment">
	<imports>
		<import>texture/GammaCorrect</import>
		<import>texture/GetNormal</import>
		<import>texture/Texture</import>
		<import>math/BreakFloat4</import>
		<import>math/BreakFloat3</import>
		<import>math/BreakFloat2</import>
		<import>math/MakeFloat4</import>
		<import>math/MakeFloat3</import>
		<import>math/MakeFloat2</import>
	</imports>
	<s_outputs>
		<output>
			<disp_name>Position</disp_name>
			<location>0</location>
			<type>FLOAT4</type>
			<name>gPosition</name>
		</output>
		<output>
			<disp_name>Albedo</disp_name>
			<location>1</location>
			<type>FLOAT4</type>
			<name>gAlebdo</name>
		</output>
		<output>
			<disp_name>Metallic</disp_name>
			<location>2</location>
			<type>FLOAT4</type>
			<name>gMetallic</name>
		</output>
		<output>
			<disp_name>Normal</disp_name>
			<location>3</location>
			<type>FLOAT4</type>
			<name>gNormal</name>
		</output>
	</s_outputs>
	<s_inputs>
		<input>
			<disp_name>Fragment In</disp_name>
			<location>0</location>
			<type>DataBlock</type>
			<name>fs_in</name>
		</input>
	</s_inputs>
	<u_inputs>
		<input>
			<disp_name>Albedo Map</disp_name>
			<location>0</location>
			<type>Texture2D</type>
			<name>u_AlbedoMap</name>
		</input>
		<input>
			<disp_name>Metallic Map</disp_name>
			<location>1</location>
			<type>Texture2D</type>
			<name>u_MetallicMap</name>
		</input>
		<input>
			<disp_name>Normal Map</disp_name>
			<location>2</location>
			<type>Texture2D</type>
			<name>u_NormalMap</name>
		</input>
		<input>
			<disp_name>Albedo Colour</disp_name>
			<location>3</location>
			<type>FLOAT4</type>
			<name>u_AlbedoColor</name>
		</input>
		<input>
			<disp_name>Metallic Colour</disp_name>
			<location>4</location>
			<type>FLOAT4</type>
			<name>u_MetallicColor</name>
		</input>
		<input>
			<disp_name>Normal Colour</disp_name>
			<location>5</location>
			<type>FLOAT3</type>
			<name>u_NormalColor</name>
		</input>
		<input>
			<disp_name>Using Albedo Map</disp_name>
			<location>6</location>
			<type>BOOL</type>
			<name>u_UsingAlbedoMap</name>
		</input>
		<input>
			<disp_name>Using Metallic Map</disp_name>
			<location>7</location>
			<type>BOOL</type>
			<name>u_UsingMetallicMap</name>
		</input>
		<input>
			<disp_name>Using Normal Map</disp_name>
			<location>8</location>
			<type>BOOL</type>
			<name>u_UsingNormalMap</name>
		</input>
	</u_inputs>
	<structs>
		<struct>
			<disp_name>Data Block</disp_name>
			<name>DataBlock</name>
			<fields>
				<field>
					<disp_name>Position</disp_name>
					<type>FLOAT4</type>
					<name>position</name>
				</field>
				<field>
					<disp_name>Normal</disp_name>
					<type>FLOAT3</type>
					<name>normal</name>
				</field>
				<field>
					<disp_name>Texture Coordinates</disp_name>
					<type>FLOAT2</type>
					<name>uv</name>
				</field>
				<field>
					<disp_name>Binormal</disp_name>
					<type>FLOAT3</type>
					<name>binormal</name>
				</field>
				<field>
					<disp_name>Tangent</disp_name>
					<type>FLOAT3</type>
					<name>tangent</name>
				</field>
			</fields>
		</struct>
		<struct>
			<disp_name>Material</disp_name>
			<name>Material</name>
			<fields>
				<field>
					<disp_name>Albedo</disp_name>
					<type>FLOAT4</type>
					<name>albedo</name>
				</field>
				<field>
					<disp_name>Metallic</disp_name>
					<type>FLOAT4</type>
					<name>metallic</name>
				</field>
			</fields>
		</struct>
		<struct>
			<disp_name>Attributes</disp_name>
			<name>Attributes</name>
			<fields>
				<field>
					<disp_name>Position</disp_name>
					<type>FLOAT3</type>
					<name>position</name>
				</field>
				<field>
					<disp_name>Normal</disp_name>
					<type>FLOAT3</type>
					<name>normal</name>
				</field>
				<field>
					<disp_name>Binormal</disp_name>
					<type>FLOAT3</type>
					<name>binormal</name>
				</field>
				<field>
					<disp_name>Tangent</disp_name>
					<type>FLOAT3</type>
					<name>tangent</name>
				</field>
			</fields>
		</struct>
	</structs>
	<fields>
		<field>
			<disp_name>Attributes</disp_name>
			<type>Attributes</type>
			<name>g_Attributes</name>
		</field>
		<field>
			<disp_name>Material</disp_name>
			<type>Material</type>
			<name>g_Material</name>
		</field>
	</fields>
	<main_instruction>
		<instruction>
			<type>Call_Func</type>
			<call_func>
				<func_name>BreakFloat4</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>fs_in.position</name>
					</input>
				</inputs>
				<outputs>
					<output>
						<location>0</location>
						<name>t_x</name>
					</output>
					<output>
						<location>1</location>
						<name>t_y</name>
					</output>
					<output>
						<location>2</location>
						<name>t_z</name>
					</output>
				</outputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>g_Attributes.position</set_field>
			<call_func>
				<func_name>MakeFloat3</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>t_x</name>
					</input>
					<input>
						<location>1</location>
						<name>t_y</name>
					</input>
					<input>
						<location>2</location>
						<name>t_z</name>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>g_Attributes.normal</set_field>
			<call_func>
				<func_name>Texture</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>u_NormalMap</name>
					</input>
					<input>
						<location>1</location>
						<name>fs_in.uv</name>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>g_Attributes.normal</set_field>
			<call_func>
				<func_name>GetNormal</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>g_Attributes.normal</name>
					</input>
					<input>
						<location>1</location>
						<name>fs_in.normal</name>
					</input>
					<input>
						<location>2</location>
						<name>fs_in.binormal</name>
					</input>
					<input>
						<location>3</location>
						<name>fs_in.tangent</name>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>g_Material.albedo</set_field>
			<call_func>
				<func_name>Texture</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>u_AlbedoMap</name>
					</input>
					<input>
						<location>1</location>
						<name>fs_in.uv</name>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>g_Material.albedo</set_field>
			<call_func>
				<func_name>GammaCorrect</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>g_Material.albedo</name>
					</input>
					<input>
						<location>1</location>
						<name>u_Gamma</name>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>g_Material.metallic</set_field>
			<call_func>
				<func_name>Texture</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>u_MetallicMap</name>
					</input>
					<input>
						<location>1</location>
						<name>fs_in.uv</name>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>g_Material.metallic</set_field>
			<call_func>
				<func_name>GammaCorrect</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>g_Material.metallic</name>
					</input>
					<input>
						<location>1</location>
						<name>u_Gamma</name>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>gPosition</set_field>
			<call_func>
				<func_name>MakeFloat4</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>g_Attributes.position.x</name>
					</input>
					<input>
						<location>1</location>
						<name>g_Attributes.position.y</name>
					</input>
					<input>
						<location>2</location>
						<name>g_Attributes.position.z</name>
					</input>
					<input>
						<location>3</location>
						<value>1.0</value>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Func</type>
			<set_field>gNormal</set_field>
			<call_func>
				<func_name>MakeFloat4</func_name>
				<inputs>
					<input>
						<location>0</location>
						<name>g_Attributes.position.x</name>
					</input>
					<input>
						<location>1</location>
						<name>g_Attributes.position.y</name>
					</input>
					<input>
						<location>2</location>
						<name>g_Attributes.position.z</name>
					</input>
					<input>
						<location>3</location>
						<value>1.0</value>
					</input>
				</inputs>
			</call_func>
		</instruction>
		<instruction>
			<type>Set_By_Field</type>
			<set_field>gAlebdo</set_field>
			<field>g_Material.albedo</field>
		</instruction>
		<instruction>
			<type>Set_By_Field</type>
			<set_field>gMetallic</set_field>
			<in_field>g_Material.metallic</in_field>
		</instruction>
	</main_instruction>
</shader> 